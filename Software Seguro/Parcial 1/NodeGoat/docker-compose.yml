services:
  web:
    build: .
    environment:
      - NODE_ENV=development  # Opcional, ajusta seg√∫n tus necesidades
      - MONGODB_URI=mongodb://mongo:27017/nodegoat
    command: sh -c "until nc -z -w 2 mongo 27017 && echo 'mongo is ready for connections' && node artifacts/db-reset.js && npm start; do sleep 2; done"
    ports:
      - "4000:4000"

  mongo:
    image: mongo:4.4
    ports:
      - "27017:27017"  # Mapea el puerto 27017 del contenedor al puerto 27017 del host
    volumes:
      - mongo-data:/data/db  # Persistencia de datos
    command: mongod --bind_ip_all  # Asegura que MongoDB acepte conexiones desde cualquier IP

volumes:
  mongo-data: